# ---------------------------
# Code Quality workflow
# ---------------------------

include:
  # https://computing.docs.ligo.org/gitlab-ci-templates/
  - project: computing/gitlab-ci-templates
    file:
      # https://computing.docs.ligo.org/gitlab-ci-templates/python/
      - python.yml

# -- code quality -----------
#
# These jobs check the code for
# quality issues
#

flake8:
  stage: Code quality
  extends:
    # https://computing.docs.ligo.org/gitlab-ci-templates/python/#.python:flake8
    - .python:flake8
  needs: []
  variables:
    # don't fail the pipeline because of linting issues,
    # these are presented in the code-quality box in the
    # merge_request UI
    FLAKE8_OPTIONS: "--exit-zero"
  before_script:
    # pick requirements out of the setup.cfg
    - |
      REQUIREMENTS=$(python -c "
      from configparser import ConfigParser;
      cp = ConfigParser();
      cp.read('setup.cfg');
      print(cp['options.extras_require']['lint'].strip())")
    # install things
    - !reference [".python:flake8", before_script]
